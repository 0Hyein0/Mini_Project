<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.stock.model.IStockListDAO">

	<select id="stockList" resultType="com.stock.model.StockListDTO">
		SELECT P.PR_NO as PR_NO, P.PR_CODE AS PR_CODE, P.PR_NAME AS PR_NAME, TO_CHAR(PR_DATE, 'YYYY-MM-DD') AS PR_DATE,
       (SELECT NVL(SUM(IN_QUANTITY), 0)
        FROM (
            SELECT DISTINCT IN_CODE, PR_NO, IN_DATE, IN_QUANTITY
            FROM IN_DATA
        ) DISTINCT_IN
        WHERE DISTINCT_IN.PR_NO = P.PR_NO) AS TOTAL_IN,
       (SELECT NVL(SUM(OUT_QUANTITY), 0)
        FROM (
            SELECT DISTINCT OUT_CODE, PR_NO, OUT_DATE, OUT_QUANTITY
            FROM OUT_DATA
        ) DISTINCT_OUT
        WHERE DISTINCT_OUT.PR_NO = P.PR_NO) AS TOTAL_OUT
	FROM PRODUCTS P
	</select>
	
	<select id="inList" resultType="com.stock.model.StockListDTO">
		SELECT I.IN_CODE AS IN_CODE, I.IN_QUANTITY AS IN_QUANTITY, TO_CHAR(I.IN_DATE, 'YYYY-MM-DD') AS IN_DATE, I.IN_DESCRIPTION AS IN_DESCRIPTION
    	, W.WA_NAME AS WA_NAME, P.PR_NO AS PR_NO, P.PR_CODE AS PR_CODE, P.PR_NAME AS PR_NAME, TO_CHAR(P.PR_DATE, 'YYYY-MM-DD')AS PR_DATE, P.PR_DESCRIPTION AS PR_DESCRIPTION
		FROM IN_DATA I JOIN PRODUCTS P
		ON I.PR_NO = P.PR_NO
		JOIN WAREHOUSES W
		ON I.WA_CODE = W.WA_CODE
		ORDER BY I.IN_CODE DESC
	</select>


</mapper>